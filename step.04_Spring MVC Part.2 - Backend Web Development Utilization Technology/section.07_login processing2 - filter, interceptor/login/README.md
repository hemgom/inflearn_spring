# 섹션 07. 로그인 처리2 - 필터, 인터셉터
## 01. 서블릿 필터 - 소개
### 공통 관심 사항
- 로그인 한 사용자만 상품 관리 페이지에 접속할 수 있어야 함
- 등록, 수정, 삭제, 조회 등 상품 관리의 모든 컨트롤러 로직에 공통으로 로그인 여부를 확인해야 함
  - 로그인과 관련된 로직이 변경 되면 작성한 모든 로직을 전부 수정해야 할 수 있음
- 애플리케이션 여러 로직에서 공통으로 관심이 있는 것을 `공통 관심사(cross-cutting-concern)`라고 함
- 공통 관심사는 스프링의 AOP로 해결할 수 있으나 `서블릿 필터, 스프링 인터셉터`를 사용하는 것이 좋음
  - 서블릿 필터, 스프링 인터셉터: `HttpServletRequest`를 제공함
<br/>

### 서블릿 필터 소개
필터는 서블릿이 지원하는 수문장!  
<br/>

#### 필터 흐름
```
HTTP 요청 -> WAS -> 필터 -> 서블릿 -> 컨트롤러
```
- 필터를 적용하면필터 호출 다음 서블릿이 호출됨
  - 때문에 모든 고객 요청 로그를 남기는 요구사항이 있다면 필터를 사용함
  - 필터는 특정 URL 패턴에 적용할 수 있음 (`/*` 적용 -> 모든 요청에 필터가 적용됨)
  - 스프링 사용하는 경우 말하는 `서블릿`은 디스패처 서블릿으로 생각하면 됨  
<br/>

#### 필터 제한
```
HTTP 요청 -> WAS -> 필터 -> 서블릿 -> 컨트롤러 //로그인 사용자
HTTP 요청 -> WAS -> 필터(적절하지 않은 요청이라 판단, 서블릿 호출X) //비 로그인 사용자
```
- 필터에 적절하지 않은 요청이라 판단되면 해당 부분에서 작업을 끝낼 수 있음
  - 로그인 여부 체크에 딱 좋음  
<br/>

#### 필터 체인
```
HTTP 요청 -> WAS -> 필터1 -> 필터2 -> 필터3 -> 서블릿 -> 컨트롤러
```
- 필터는 체인으로 구성됨
  - 중간에 필터를 자유롭게 추가할 수 있음
  - ex) 로그를 남기는 필터를 먼저 적용, 로그인 여부를 체크하는 필터 생성 가능  
<br/>

#### 필터 인터페이스
```java
public interface Filter {

        public default void init(FilterConfig filterConfig) throws ServletException {}

        public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException;

        public default void destroy() {}
}
```
- 필터 인터페이스를 구현, 등록하면 서블릿 컨테이너가 필터를 싱글톤 객체로 생성, 관리함
  - `init()`: 필터 초기화 메서드, 서블릿 컨테이너가 생성될 때 호출됨
  - `doFilter()`: 고객의 요청이 올 때 마다 해당 메서드가 호출됨, 필터의 로직을 구현하면 됨
  - `destroy()`: 필터 종료 메서드, 서블릿 컨테이너가 종료될 때 호출됨