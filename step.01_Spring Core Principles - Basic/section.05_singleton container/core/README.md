# 섹션 05. 싱글톤 컨테이너
## 01. 웹 애플리케이션과 싱글톤
![img.jpg](img.jpg)
- 스프링은 `기업용 온라인 서비스 기술`을 지원하기 위해 태어났다.
- 대부분의 스프링 애플리케이션은 `웹 애플리케이션`이다.
  - 물론 그 외의 개발도 얼마든지 가능하다.
- 웹 애플리케이션의 경우 보통 `다수의 고객`으로부터 `동시 요청`이 발생한다.  
<br/>

### 스프링 없는 순수한 DI 컨테이너 예제 코드 - SingleTonTest
- `AppConfig`(스프링 없는 순수한 DI 컨테이너)는 요청이 들어올 때 마다 객체를 새로 생성함
  1. 고객 트래픽이 초당 100이 나오게되면 초당 100개 객체가 생성되고 소멸함 -> `메모리 낭비가 심함`
  2. 메모리 낭비를 막기위해 객체는 `딱 1개`만 생성하고 이를 공유해서 사용하도록 함 -> `싱글톤 패턴`  
<br/><br/><br/>

## 02. 싱글톤 패턴
클래스의 인스턴트(객체)가 딱 1개만 생성되는 것을 보장하는 디자인 패턴
- `private` 생성자를 사용해 외부에서 임의로 `new 키워드`를 사용하지 못하도록 해야 함  
<br/>

### 싱글톤 패턴 예제 코드 - SingletonService(테스트 코드 쪽에 작성)
- statice 영역에 `instance`를 미리 하나 생성해 올려둠
- 해당 객체 인스턴스가 필요할 경우 오직 `getInstance()`메서드를 통해서만 조회 가능
  - 해당 메서드 호출 시 항상 같은 인스턴스를 반환
- 생성자를 `private`으로 설점
  - 딱 1개의 객체 인스턴스가 존재해야하므로 외부에서 객체 인스턴스가 생성되는 걸 막음  
<br/>

### 싱클톤 패턴 테스트 코드 - SingleTonTest(singletonServiceTest())
- `private`를 사용해 `new 키워드`를 막아둬 해당 키워드 사용시 오류가 발생함
- 호출할 때 마다 같은 객체 인스턴스를 반환함  
<br/>

- `참고(1)` : `isEqualTo()`와 `isSameAs()`의 차이
  - `isSameAs()` : 자바의 `==`연산과 같음, 원시형 타입은 값을 비교, `인스턴스(객체)는 주소`를 비교해 서로 같은지를 확인
  - `isEqualTo()` : 저장된 값을 기준으로 비교, `객체의 값`이 같은지 비교하고 싶다면 이를 사용  
<br/>

### 싱글톤 패턴 문제점
싱글톤 패턴 적용시 이미 만들어진 객체를 공유해서 효율적으로 사용이 가능하다.  
하지만, 아래와 같은 많은 문제점들을 가지고 있다.
- 구현하는데 많은 코드를 필요로 한다.
- 의존관계를 보면 클라이언트가 구체 클래스에 의존하고 있다. 이는 `DIP` 위반이다.
  - 또한 이 때문에 `OCP`를 위반할 가능성이 높음
- 테스트하기가 쉽지 않음
- 내부 속성 변경 및 초기화가 어려움
- `private`생성자로 인해 자식클래스 생성이 어려움
- 결론적으로 `유연성`이 떨어져 `안티 패턴`으로 불리기도 함  
<br/><br/><br/>

## 03. 싱글톤 컨테이너
스프링 컨테이너는 싱글톤 패턴의 문제점을 해결하면서 객체 인스턴스를 싱글톤으로 관리한다.  
  - 지금까지 배운 `스프링 빈`이 싱글톤으로 관리된다.  
<br/>

### 싱글톤 컨테이너
- `스프링 컨테이너` : 싱글톤 패턴을 적용하지 않아도 객체 인스턴스를 싱글톤으로 관리
   - 싱글톤 컨테이너 역할을 함, 싱글톤 객체를 생성 및 관리하는 기능을 `싱글톤 레지스트리`라 함
   - 싱글턴 패턴의 모든 단점을 해결하며 객체를 싱글톤으로 유지할 수 있음  
<br/>

### 스프링 컨테이너를 사용하는 테스트 코드 - SingleTonTest(springContainer())
기존 싱글톤 컨테이너를 스프링 컨테이너로 수정하였다.  
기존 코드는 주석처리 해두었으니 한 번 비교해보도록 하자!  
<br/>

### 싱글톤 컨테이너 적용 후
![img_1.jpg](img_1.jpg)
- 스프링 컨테이너 덕분에 고객의 요청이 올 때 마다 객체를 생성할 필요가 없음
- 이미 만들어진 객체를 공유해서 낭비없이 효율적으로 재사용이 가능함  
<br/>

- `참고(2)` : 스프링의 기본 빈 등록방식은 싱글톤이나 해당 방식만을 지원하는 것은 아니다.
  - 요청마다 새로운 객체를 생성해서 반환하는 기능도 있다.  
  - 그러나 거의 대부분 99%는 기본 빈 등록방식을 사용한다.

